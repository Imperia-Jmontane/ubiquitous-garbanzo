@using System.Linq
@model IReadOnlyCollection<MyApp.Models.Home.RepositoryListItemViewModel>

<div data-repository-payload="true" data-count="@Model.Count">
    @if (!Model.Any())
    {
        <div class="mt-8 rounded-xl border border-dashed border-white/10 bg-black/30 p-6 text-sm text-gray-300" data-empty-state="true">
            No repositories have been cloned yet. Use the form above to add the first repository.
        </div>
    }
    else
    {
        <ul class="mt-8 space-y-4" data-repository-items="true">
            @foreach (MyApp.Models.Home.RepositoryListItemViewModel repository in Model)
            {
                <li class="rounded-xl border border-white/10 bg-black/40 p-6 text-sm text-gray-100" data-repository-item="true">
                    <details class="group" @(repository.HasBranches ? string.Empty : "open")>
                        <summary class="flex cursor-pointer list-none items-center justify-between gap-4">
                            <div>
                                <h3 class="text-lg font-semibold text-white">@repository.Name</h3>
                                <p class="mt-1 truncate text-xs text-gray-400">@repository.RepositoryPath</p>
                                @if (!string.IsNullOrWhiteSpace(repository.RemoteUrl))
                                {
                                    <p class="mt-1 text-xs text-indigo-200">@repository.RemoteUrl</p>
                                }
                                <div class="mt-3 flex flex-wrap gap-2 text-xs">
                                    @if (repository.HasUnsyncedChanges)
                                    {
                                        <span class="inline-flex items-center gap-1 rounded-full border border-yellow-500/60 bg-yellow-500/15 px-3 py-1 font-medium text-yellow-200">
                                            <span class="size-1.5 rounded-full bg-yellow-400"></span>
                                            Local changes not synchronized
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="inline-flex items-center gap-1 rounded-full border border-emerald-500/40 bg-emerald-500/10 px-3 py-1 font-medium text-emerald-200">
                                            <span class="size-1.5 rounded-full bg-emerald-400"></span>
                                            Synchronized with origin
                                        </span>
                                    }

                                    @if (!repository.HasRemote)
                                    {
                                        <span class="inline-flex items-center gap-1 rounded-full border border-red-500/50 bg-red-500/10 px-3 py-1 font-medium text-red-200">
                                            <span class="size-1.5 rounded-full bg-red-400"></span>
                                            No remote configured
                                        </span>
                                    }
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-medium text-gray-200">
                                    <span class="h-2 w-2 rounded-full bg-indigo-400"></span>
                                    @repository.Branches.Count branch@(repository.Branches.Count == 1 ? string.Empty : "es")
                                </span>
                                <button type="button" class="inline-flex items-center gap-1 rounded-md border border-red-500/50 bg-red-500/10 px-3 py-1 text-xs font-semibold text-red-200 transition hover:bg-red-500/20 focus:outline-none focus:ring-2 focus:ring-red-400/70 focus:ring-offset-2 focus:ring-offset-gray-900" data-repository-delete="true" data-repository-name="@repository.Name" data-repository-path="@repository.RepositoryPath" data-repository-remote="@repository.RemoteUrl" data-repository-unsynced="@(repository.HasUnsyncedChanges ? "true" : "false")" data-repository-has-remote="@(repository.HasRemote ? "true" : "false")" data-repository-uncommitted="@(repository.HasUncommittedChanges ? "true" : "false")" data-repository-unpushed="@(repository.HasUnpushedCommits ? "true" : "false")">
                                    <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-4">
                                        <path fill-rule="evenodd" d="M7 2.75A1.75 1.75 0 0 1 8.75 1h2.5A1.75 1.75 0 0 1 13 2.75V3h3.25a.75.75 0 0 1 0 1.5h-.452l-.729 11.02A2.25 2.25 0 0 1 12.825 17.75H7.175a2.25 2.25 0 0 1-1.994-2.23L4.452 4.5H4a.75.75 0 0 1 0-1.5H7Zm1.5 0a.25.25 0 0 0-.25.25V3h3.5v-.25a.25.25 0 0 0-.25-.25h-3Zm4.599 12.495.684-10.745H6.217l.684 10.745a.75.75 0 0 0 .748.705h5.702a.75.75 0 0 0 .748-.705ZM8.75 7.75a.75.75 0 0 1 .75.75v5a.75.75 0 0 1-1.5 0v-5a.75.75 0 0 1 .75-.75Zm2.5 0a.75.75 0 0 1 .75.75v5a.75.75 0 0 1-1.5 0v-5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd"></path>
                                    </svg>
                                    Remove
                                </button>
                            </div>
                        </summary>
                        <div class="mt-4 space-y-3">
                            @if (!repository.HasBranches)
                            {
                                <p class="rounded-lg border border-dashed border-white/10 bg-black/40 px-4 py-3 text-xs text-gray-400">
                                    No local branches were found for this repository.
                                </p>
                            }
                            else
                            {
                                <ul class="grid gap-3 sm:grid-cols-2">
                                    @foreach (string branch in repository.Branches)
                                    {
                                        <li class="rounded-lg border border-white/10 bg-gray-900/60 px-4 py-3 text-xs text-gray-200">
                                            <span class="font-semibold text-white">@branch</span>
                                        </li>
                                    }
                                </ul>
                            }
                        </div>
                    </details>
                </li>
            }
        </ul>
    }
</div>
