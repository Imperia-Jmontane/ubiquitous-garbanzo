@using System.Linq
@model IReadOnlyCollection<MyApp.Models.Home.RepositoryListItemViewModel>

<div data-repository-payload="true" data-count="@Model.Count">
    @if (!Model.Any())
    {
        <div class="mt-8 rounded-xl border border-dashed border-white/10 bg-black/30 p-6 text-sm text-gray-300" data-empty-state="true">
            No repositories have been cloned yet. Use the form above to add the first repository.
        </div>
    }
    else
    {
        <ul class="mt-8 space-y-4" data-repository-items="true">
            @foreach (MyApp.Models.Home.RepositoryListItemViewModel repository in Model)
            {
                <li class="rounded-xl border border-white/10 bg-black/40 p-6 text-sm text-gray-100">
                    <details class="group" @(repository.HasBranches ? string.Empty : "open")>
                        <summary class="flex cursor-pointer list-none items-center justify-between gap-4">
                            <div>
                                <h3 class="text-lg font-semibold text-white">@repository.Name</h3>
                                <p class="mt-1 truncate text-xs text-gray-400">@repository.RepositoryPath</p>
                                @if (!string.IsNullOrWhiteSpace(repository.RemoteUrl))
                                {
                                    <p class="mt-1 text-xs text-indigo-200">@repository.RemoteUrl</p>
                                }
                            </div>
                            <span class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-medium text-gray-200">
                                <span class="h-2 w-2 rounded-full bg-indigo-400"></span>
                                @repository.Branches.Count branch@(repository.Branches.Count == 1 ? string.Empty : "es")
                            </span>
                        </summary>
                        <div class="mt-4 space-y-3">
                            @if (!repository.HasBranches)
                            {
                                <p class="rounded-lg border border-dashed border-white/10 bg-black/40 px-4 py-3 text-xs text-gray-400">
                                    No local branches were found for this repository.
                                </p>
                            }
                            else
                            {
                                <ul class="grid gap-3 sm:grid-cols-2">
                                    @foreach (string branch in repository.Branches)
                                    {
                                        <li class="rounded-lg border border-white/10 bg-gray-900/60 px-4 py-3 text-xs text-gray-200">
                                            <span class="font-semibold text-white">@branch</span>
                                        </li>
                                    }
                                </ul>
                            }
                        </div>
                    </details>
                    <div class="mt-4 flex flex-col gap-3 border-t border-white/5 pt-4 sm:flex-row sm:items-center sm:justify-between">
                        <div class="flex-1 space-y-1 text-xs text-gray-300">
                            <p>Removing the repository deletes the local files from this workspace.</p>
                            @if (!repository.HasRemote)
                            {
                                <p class="text-amber-200">No remote origin was detected. This repository exists only on this machine.</p>
                            }
                            @if (repository.HasUnsyncedChanges)
                            {
                                <p class="text-amber-200">Unsynchronized local changes were detected and will be lost permanently.</p>
                            }
                        </div>
                        <div class="flex justify-end sm:justify-start">
                            <button type="button" class="inline-flex items-center gap-2 rounded-lg border border-red-500/50 bg-red-500/10 px-4 py-2 text-xs font-semibold text-red-200 transition hover:bg-red-500/20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-400" data-repository-delete="true" data-repository-name="@repository.Name" data-has-remote="@(repository.HasRemote ? "true" : "false")" data-has-uncommitted="@(repository.HasUncommittedChanges ? "true" : "false")" data-has-unpushed="@(repository.HasUnpushedCommits ? "true" : "false")">Delete local copy</button>
                        </div>
                    </div>
                </li>
            }
        </ul>
    }
</div>
