@using System.Collections.Generic
@using System.Linq

@functions {
    public class RepositoryOverview
    {
        public string Name { get; set; } = string.Empty;

        public string Description { get; set; } = string.Empty;

        public string Owner { get; set; } = string.Empty;

        public string Branch { get; set; } = string.Empty;

        public string LastUpdated { get; set; } = string.Empty;

        public string Status { get; set; } = string.Empty;

        public string PrimaryLanguage { get; set; } = string.Empty;

        public int OpenPullRequests { get; set; }

        public int OpenIssues { get; set; }

        public List<string> Tags { get; set; } = new List<string>();
    }

    public class RepositoryDeployment
    {
        public string Environment { get; set; } = string.Empty;

        public string Version { get; set; } = string.Empty;

        public string ReleasedAt { get; set; } = string.Empty;

        public string Health { get; set; } = string.Empty;
    }

    public class RepositoryActivity
    {
        public string Title { get; set; } = string.Empty;

        public string Description { get; set; } = string.Empty;

        public string When { get; set; } = string.Empty;
    }
}

@{
    ViewData["Title"] = "Home";

    List<RepositoryOverview> repositories = new List<RepositoryOverview>
    {
        new RepositoryOverview
        {
            Name = "Flow Builder Core",
            Description = "Servicios principales y dominio de orquestación para los flowcharts productivos.",
            Owner = "Equipo Core Platform",
            Branch = "main",
            LastUpdated = "Actualizado hace 1 hora",
            Status = "Operativo",
            PrimaryLanguage = "C#",
            OpenPullRequests = 4,
            OpenIssues = 18,
            Tags = new List<string> { "Domain", "API", "Infra" }
        },
        new RepositoryOverview
        {
            Name = "Flow Frontend",
            Description = "Aplicación web en React para canvas, colaboración y visualización en tiempo real.",
            Owner = "Equipo Experience",
            Branch = "develop",
            LastUpdated = "Actualizado hace 3 horas",
            Status = "QA",
            PrimaryLanguage = "TypeScript",
            OpenPullRequests = 7,
            OpenIssues = 25,
            Tags = new List<string> { "UI", "Realtime", "Design-System" }
        },
        new RepositoryOverview
        {
            Name = "Automation Workers",
            Description = "Workers para ejecutar tareas programadas, webhooks y sincronizaciones con terceros.",
            Owner = "Equipo Automation",
            Branch = "main",
            LastUpdated = "Actualizado ayer",
            Status = "Monitoreo",
            PrimaryLanguage = "Python",
            OpenPullRequests = 2,
            OpenIssues = 9,
            Tags = new List<string> { "Jobs", "Integration", "Monitoring" }
        },
        new RepositoryOverview
        {
            Name = "Flow Analytics",
            Description = "Pipelines y métricas para el seguimiento de performance de los flowcharts publicados.",
            Owner = "Equipo Data & BI",
            Branch = "analytics-main",
            LastUpdated = "Actualizado hace 2 días",
            Status = "Analizando",
            PrimaryLanguage = "SQL",
            OpenPullRequests = 1,
            OpenIssues = 6,
            Tags = new List<string> { "Data", "ELT", "Dashboards" }
        }
    };

    List<RepositoryDeployment> deployments = new List<RepositoryDeployment>
    {
        new RepositoryDeployment { Environment = "Producción", Version = "2024.06.1", ReleasedAt = "Publicado hace 6 horas", Health = "Estable" },
        new RepositoryDeployment { Environment = "Staging", Version = "2024.06.3-rc1", ReleasedAt = "Publicado hace 45 minutos", Health = "Verificado" },
        new RepositoryDeployment { Environment = "Beta clientes", Version = "2024.05.28", ReleasedAt = "Publicado hace 3 días", Health = "Seguimiento" }
    };

    List<RepositoryActivity> recentActivity = new List<RepositoryActivity>
    {
        new RepositoryActivity { Title = "Merge en Flow Builder Core", Description = "Se integró la refactorización de autenticación y endpoints de auditoría.", When = "Hace 40 minutos" },
        new RepositoryActivity { Title = "Despliegue de Automation Workers", Description = "Nueva política de reintentos y alertas vía PagerDuty.", When = "Hoy 09:20" },
        new RepositoryActivity { Title = "Pull request en Flow Frontend", Description = "Actualización del sistema de tabs para el canvas colaborativo.", When = "Ayer 18:15" }
    };
}

<section class="space-y-8 text-gray-100">
    <header class="rounded-3xl border border-white/10 bg-gray-900/70 p-6 shadow-inner shadow-black/20">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
            <div class="max-w-2xl space-y-3">
                <span class="inline-flex items-center gap-2 rounded-full bg-indigo-500/10 px-3 py-1 text-xs font-semibold text-indigo-200">Repositorios</span>
                <h1 class="text-3xl font-semibold text-white">Todo tu catálogo de código en un solo vistazo</h1>
                <p class="text-sm text-gray-400">Consulta qué repositorios están activos, quién los mantiene y cuál es su estado operativo antes de abrirlos en el editor.</p>
            </div>
            <div class="grid gap-3 text-sm text-gray-300 sm:grid-cols-2">
                <div class="rounded-2xl border border-white/10 bg-gray-900/60 p-4 shadow-inner shadow-black/30">
                    <p class="text-xs uppercase tracking-wide text-gray-500">Repos monitoreados</p>
                    <p class="mt-2 text-2xl font-semibold text-white">@repositories.Count</p>
                    <p class="text-xs text-emerald-300">+1 en la última semana</p>
                </div>
                <div class="rounded-2xl border border-white/10 bg-gray-900/60 p-4 shadow-inner shadow-black/30">
                    <p class="text-xs uppercase tracking-wide text-gray-500">Pull requests abiertos</p>
                    <p class="mt-2 text-2xl font-semibold text-white">@repositories.Sum(repository => repository.OpenPullRequests)</p>
                    <p class="text-xs text-indigo-300">2 listos para revisión hoy</p>
                </div>
            </div>
        </div>
    </header>

    <section class="space-y-4">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h2 class="text-xl font-semibold text-white">Repositorios disponibles</h2>
                <p class="text-sm text-gray-400">Abre cualquiera de ellos para trabajar en el flujo correspondiente.</p>
            </div>
            <div class="flex gap-2">
                <button type="button" class="inline-flex items-center gap-2 rounded-lg border border-white/10 bg-white/5 px-4 py-2 text-sm font-medium text-gray-200 transition hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500">
                    Importar repositorio
                </button>
                <button type="button" class="inline-flex items-center gap-2 rounded-lg bg-indigo-500 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-indigo-950/40 transition hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-400">
                    Crear repositorio
                </button>
            </div>
        </div>
        <div class="grid gap-4 xl:grid-cols-2">
            @foreach (RepositoryOverview repository in repositories)
            {
                <article class="flex h-full flex-col justify-between rounded-2xl border border-white/10 bg-gray-900/70 p-6 shadow-inner shadow-black/30 transition hover:border-indigo-400/60 hover:shadow-xl hover:shadow-indigo-950/40">
                    <div class="space-y-4">
                        <div class="flex flex-wrap items-start justify-between gap-3">
                            <div>
                                <h3 class="text-lg font-semibold text-white">@repository.Name</h3>
                                <p class="mt-1 text-sm text-gray-400">@repository.Description</p>
                            </div>
                            <span class="inline-flex items-center gap-2 rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-medium text-emerald-300">
                                <span class="size-2 rounded-full bg-emerald-400"></span>
                                @repository.Status
                            </span>
                        </div>
                        <div class="flex flex-wrap items-center gap-2 text-xs text-gray-300">
                            <span class="inline-flex items-center gap-1 rounded-full bg-white/10 px-3 py-1 font-medium text-gray-200">
                                <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-3 text-indigo-300">
                                    <path fill-rule="evenodd" d="M4.25 4.25A1.75 1.75 0 0 1 6 2.5h8a1.75 1.75 0 0 1 1.75 1.75v10A1.75 1.75 0 0 1 14 16h-3.25l-.447 1.34a.75.75 0 0 1-1.41 0L8.447 16H6a1.75 1.75 0 0 1-1.75-1.75v-10Z" clip-rule="evenodd" />
                                </svg>
                                @repository.Branch
                            </span>
                            <span class="inline-flex items-center gap-1 rounded-full border border-white/10 px-3 py-1 text-gray-300">
                                <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-3 text-indigo-300">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-8.75V5a.75.75 0 0 0-1.5 0v4.75c0 .199.079.39.22.53l3 3a.75.75 0 0 0 1.06-1.06L10.75 9.25Z" clip-rule="evenodd" />
                                </svg>
                                @repository.LastUpdated
                            </span>
                            <span class="inline-flex items-center gap-1 rounded-full border border-white/10 px-3 py-1 text-gray-300">
                                <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-3 text-indigo-300">
                                    <path fill-rule="evenodd" d="M3.5 4.75A1.75 1.75 0 0 1 5.25 3h9.5A1.75 1.75 0 0 1 16.5 4.75v10.5A1.75 1.75 0 0 1 14.75 17h-9.5A1.75 1.75 0 0 1 3.5 15.25V4.75Zm2.75.25a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0v-1.5Zm7.75-.75a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 1.5 0v-1.5a.75.75 0 0 0-.75-.75ZM6.5 8a.75.75 0 0 1 .75-.75h5.5A.75.75 0 0 1 13.5 8v2.25a.75.75 0 0 1-.75.75h-5.5A.75.75 0 0 1 6.5 10.25V8Z" clip-rule="evenodd" />
                                </svg>
                                @repository.PrimaryLanguage
                            </span>
                        </div>
                        <div class="flex flex-wrap items-center gap-2 text-xs text-gray-400">
                            @foreach (string tag in repository.Tags)
                            {
                                <span class="inline-flex items-center gap-2 rounded-full bg-white/5 px-3 py-1 text-xs font-medium text-gray-300">
                                    <span class="size-1.5 rounded-full bg-indigo-400"></span>
                                    @tag
                                </span>
                            }
                        </div>
                    </div>
                    <div class="mt-6 flex flex-wrap items-center gap-3 text-xs text-gray-300">
                        <span class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 font-medium text-white">
                            <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-3 text-indigo-300">
                                <path fill-rule="evenodd" d="M9.232 1.21a1 1 0 0 1 1.536 0l1.856 2.27 2.78.665a1 1 0 0 1 .555 1.61l-1.92 2.12.284 2.897a1 1 0 0 1-1.39 1.02L10 10.954l-2.934 1.84a1 1 0 0 1-1.39-1.02l.283-2.898-1.92-2.12a1 1 0 0 1 .555-1.61l2.78-.665 1.858-2.27Z" clip-rule="evenodd" />
                            </svg>
                            @repository.OpenPullRequests PR abiertos
                        </span>
                        <span class="inline-flex items-center gap-2 rounded-full border border-white/10 px-3 py-1">
                            <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-3 text-indigo-300">
                                <path fill-rule="evenodd" d="M10 2a8 8 0 1 0 5.293 14.05.75.75 0 0 0-.553-1.392 6.5 6.5 0 1 1 0-11.314.75.75 0 0 0 .552-1.392A7.963 7.963 0 0 0 10 2Zm0 4a.75.75 0 0 1 .75.75V10a.75.75 0 0 1-1.5 0V6.75A.75.75 0 0 1 10 6Zm.002 6a1 1 0 1 1-.002 2 1 1 0 0 1 .002-2Z" clip-rule="evenodd" />
                            </svg>
                            @repository.OpenIssues incidencias abiertas
                        </span>
                        <button type="button" class="inline-flex items-center gap-2 rounded-full border border-indigo-400/40 px-3 py-1 text-indigo-200 hover:bg-indigo-500/10">
                            Abrir repo
                            <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="size-3">
                                <path fill-rule="evenodd" d="M5.22 4.22a.75.75 0 0 1 1.06 0L13 10.94l-6.72 6.72a.75.75 0 1 1-1.06-1.06L10.44 11 5.22 5.78a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </article>
            }
        </div>
    </section>

    <section class="grid gap-6 lg:grid-cols-[minmax(0,2fr),minmax(0,1fr)]">
        <div class="rounded-2xl border border-white/10 bg-gray-900/60 p-6 shadow-inner shadow-black/30">
            <h2 class="text-lg font-semibold text-white">Actividad reciente</h2>
            <ul class="mt-4 space-y-4">
                @foreach (RepositoryActivity activity in recentActivity)
                {
                    <li class="rounded-xl border border-white/10 bg-white/5 p-4 text-sm text-gray-300">
                        <div class="flex items-start justify-between gap-3">
                            <div>
                                <p class="font-semibold text-white">@activity.Title</p>
                                <p class="mt-1 text-sm text-gray-400">@activity.Description</p>
                            </div>
                            <span class="text-xs text-indigo-200">@activity.When</span>
                        </div>
                    </li>
                }
            </ul>
        </div>
        <aside class="rounded-2xl border border-white/10 bg-gray-900/60 p-6 shadow-inner shadow-black/30">
            <h2 class="text-lg font-semibold text-white">Estado de despliegues</h2>
            <ul class="mt-4 space-y-3 text-sm text-gray-300">
                @foreach (RepositoryDeployment deployment in deployments)
                {
                    <li class="flex items-start justify-between gap-3 rounded-xl border border-white/10 bg-white/5 p-4">
                        <div>
                            <p class="font-semibold text-white">@deployment.Environment</p>
                            <p class="text-xs text-gray-400">@deployment.Version · @deployment.ReleasedAt</p>
                        </div>
                        <span class="inline-flex items-center gap-2 rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-medium text-emerald-300">
                            <span class="size-2 rounded-full bg-emerald-400"></span>
                            @deployment.Health
                        </span>
                    </li>
                }
            </ul>
            <div class="mt-4 rounded-xl border border-dashed border-white/10 bg-black/30 p-4 text-xs text-gray-400">
                Sincroniza despliegues desde tu pipeline CI/CD para mantener este resumen actualizado automáticamente.
            </div>
        </aside>
    </section>
</section>
